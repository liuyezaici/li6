<meta http-equiv=Content-Type content="text/html;charset=utf-8">
<style type="text/css">
<!--
/* 编辑我的收货地址 */
.modify_address_form {
    margin: -20px 0 0 -10px;
}
.modify_address_form .top {
    border-bottom: 1px solid #ddd;
    padding: 5px 0;
    font-weight: bold;
    color: #666;
    font-size: 14px;
}
.modify_address_form {
    display: block;
    overflow: hidden;
    width: 100%;
    padding: 5px 0 2px 0;
}
.modify_address_form em {
    float: left;
    line-height: 28px;
    color: #bd1609;
}
.modify_address_form ul li {
    clear: both;
    width: auto;
    overflow: hidden;
    margin-bottom: 10px;
}
.modify_address_form ul li.default_address_box {
    margin: 20px 0 20px 90px;
    height: 26px;
    line-height: 16px;
}
.modify_address_form ul li.default_address_box label {
    cursor: pointer;
    color: #333;
}
.modify_address_form ul li.default_address_box label input {
    float: left;
    margin-right: 4px;
}
.modify_address_form ul li .submit_btn {
    width: 55px;
    height: 28px;
    line-height: 28px;
    background-color: #ff4a00;
    color: #fff;
    font-size: 16px;
    display: inline-block;
    text-align: center;
}
-->
</style>
<div class="right_list modify_address_form">
    <form id="modify_address_form">
        <input type="hidden" value="<?=$s_id?>" class="input" id="sid" />
        <ul>
            <li>
            <em>所在地区：</em> <select class="input" id="s_province" onchange="getProvinceCity($(this).val())"><option value="0">选择省份</option><?=$provinceHtml?></select>
                <span id="province_city"></span>
            </li>
            <li>
                <em>详细地址：</em> <input type="text" value="<?=$s_address?>" class="input" id="s_address" style="width: 450px;" maxlength="200" />
            </li>
            <li>
                <em>收货人姓名：</em> <input type="text" value="<?=$s_username?>" class="input" id="s_username" maxlength="50" />
            </li>
            <li>
                <em>手机号码：</em> <input type="text" value="<?=$s_phone?>" class="input" id="s_phone" maxlength="50" />
            </li>
            <li class="default_address_box">
                <label><input type="checkbox" id="a_ismain"> 设为默认收货地址</label>
            </li>
            <li>
                <a class="submit_btn" href="javascript: void(0);" onclick="$(this).next().click();" style="margin-left: 90px;" target="_self"><?=$btn_text?></a>
                <input type="submit" value="提交" class="hide_btn" />
            </li>
        </ul>
    </form>
</div>
<script type="text/javascript">
    var modifyName = '<?=$modify?>';
    //获取省份的市/区
    function getProvinceCity(areaId, a_city) {
        var form = $('#modify_address_form');
        a_city = a_city || 0;
        if(!areaId || areaId == 0) {
            form.find('#province_city').html('');
            return;
        }
        post("/?s=system/get_city&json=true",{
            area_id : areaId
        },function(data){
            var css_ = '';
            if(data.length==1) {
                if(data[0]['a_id'] == a_city) css_ = ' selected';
                var allCity = '<option value="'+ data[0]['a_id'] +'"'+css_+'>'+ data[0]['a_name'] +'</option>';
            } else if(data.length > 1){
                var allCity = '';
                for( var i in data ) {
                    css_ = '';
                    if(data[i]['a_id'] == a_city) css_ = ' selected';
                    allCity += '<option value="'+ data[i]['a_id'] +'"'+css_+'>'+ data[i]['a_name'] +'</option>';
                }
            } else {
                msg('没有数据 请重试', 1);
                return;
            }
            form.find('#province_city').html('<select class="input" id="my_city" style="width: 100px;">'+allCity+'</select>');
        });
    }
    $('#modify_address_form').submit(function(e) {
        e.preventDefault();
        var form = $(this);
        var sid = $.trim(form.find('#sid').val());
        var s_province = $.trim(form.find('#s_province').val());
        var my_city = $.trim(form.find('#my_city').val());
        var s_address = $.trim(form.find('#s_address').val());
        var s_username = $.trim(form.find('#s_username').val());
        var s_phone = $.trim(form.find('#s_phone').val());
        var s_ismain_check = $.trim(form.find('#a_ismain').attr('checked'));
        if(!s_province) {
            msg("请选择您的省份");
            return;
        }
        if(!my_city) {
            msg("请选择您的城市");
            return;
        }
        if(!s_address) {
            msg("请输入详细地址");
            return;
        }
        if(!s_username) {
            msg("请输入收件人姓名");
            return;
        }
        if(!s_phone) {
            msg("请输入收件人电话号码");
            return;
        }
        var s_ismain = 0;
        if(s_ismain_check == 'checked') {
            s_ismain = 1;
        }
        post("/?s=ubuyer&do=modify_address&json=true",{
            sid: sid,
            modify: modifyName,
            s_province: s_province,
            my_city: my_city,
            s_address: s_address,
            s_username: s_username,
            s_phone: s_phone,
            s_ismain: s_ismain
        },function(data){
            hideNewBox();
            if(data.id != '0043' && data.id != '0113') {
                if(data.info) data.msg += data.info;
                msg(data.msg,4);
                if(data.id == '0000') {
                    loginIn();
                    return;
                }
            } else {
                hideAllbox();
                msgTis(data.msg);
                if(typeof  delAddress == 'function' ) { //如果是在我的收货地址列表页面，需要重新刷新页面
                    ajaxOpen('/?s=ubuyer/my_address');
                } else if (typeof submitBalance == 'function') { //如果是在购物车页面修改或添加地址 直接加载新的收货地址
                    hideAllbox();
                    msgWin('选择收货地址','/?s=ubuyer/form&form=get_my_address', 800, 1,"<a target='_self' class='btn' href=\"javascript:viewAllAddress();\" >刷新</a> ");
                }
            }
        });
        msg("提交中,请勿刷新或关闭页面");
    });
    //如果是编辑状态
    if(modifyName == 'edit') {
        var form = $('#modify_address_form');
        getProvinceCity('<?=$s_province?>','<?=$s_city?>');
    }
</script>