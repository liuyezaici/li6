<!DOCTYPE html>
<html>
<head>
{include file="common/meta" /}
</head>
<base target="_parent" />
<body>
{include file="common/header" /}
{include  file="common/banner" currentBanner='musicTime' /}
<link href="/assets/css/juzi/music/post.css" rel="stylesheet">
<script src="/assets/js/juzi/player.js"></script>
<div class="front_body container">
    <div class="panel panel-info">
        {include  file="common/musicTimeTop" keyword='$keyword' /}
    </div>
</div>
<div class="front_body container">
    <div class="panel">
        <h3>
            <?=$topTitle;?>
        </h3>
        <div class="panel-body">
            <form class="form-horizontal" role="form" id="postMusicForm">
                 <div class="row rowWrap normalWrap">
                      <div class="form-group">
                          <input type="hidden" class="form-control" name="row[id]" />
                          <label for="inputSongTitle" class="col-sm-2 control-label">歌名</label>
                          <div class="col-sm-10">
                              <input type="text" class="form-control" id="inputSongTitle" name="row[songTitle]" placeholder="请输入歌曲名字" />
                          </div>
                      </div>
                      <div class="form-group">
                          <label for="inputSinger" class="col-sm-2 control-label">歌手</label>
                          <div class="col-sm-10">
                              <input type="text" class="form-control" id="inputSinger" name="row[singer]" placeholder="请输入歌手名字" />
                          </div>
                      </div>
                     <div class="form-group">
                         <label for="inputGeci" class="col-sm-2 control-label">歌词</label>
                         <div class="col-sm-10">
                             <textarea class="form-control" id="inputGeci" name="row[songGeci]" style="height: 300px;"></textarea>
                         </div>
                     </div>
                     <div class="form-group">
                         <label class="col-sm-2 control-label">是否公开</label>
                         <div class="col-sm-10">
                             <label class="openLabel">
                                 <input type="radio" class="openedFind" name="row[opened]" value="1" checked />公开
                             </label>
                             <label class="openLabel">
                                 <input type="radio" class="openedFind" name="row[opened]" value="0"  />自己可见
                             </label>
                         </div>
                     </div>
                 </div>
                <div class="row">
                    <div class="col-md-12">
                        <button type="submit" class="btn btn-block btn-info btn-lg"><?=$submitBtnText?></button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    (function (global__, $) {
        $(document).ready(function () {
            var modify = '<?=$modify?>';
            var submitMusicUrl = '/juzi/Musictime/post';
            var  musicInfo = JSON.parse($.url.decode('<?=$musicInfo?>'));
            var postForm = $('#postMusicForm');
            //赋值
            postForm.find('.form-control').each(function () {
                var input_ = $(this);
                var name_ = input_.attr('name');
                var field_ = name_.match(/row\[([a-z_A-Z]+)\]/)[1];
                input_.val(musicInfo[field_]||'');
            });
            //open
            postForm.find(".openedFind").each(function () {
                var input_ = $(this);
                if(input_.val() != musicInfo['opened']) {
                    input_.removeAttr('checked');
                } else {
                    input_.prop('checked', true);
                }
            });
            postForm.submit(function (e) {
                e.preventDefault();
                loadingSvg(true);
                var datas = {};
                $(this).serializeArray().map(function (x) {
                    datas[x.name] = x.value
                });
                rePost(submitMusicUrl, datas, function (e) {
                    noLoading();
                    if(e.code==1) {
                        msgTisf(e.msg);
                        if(modify == 'add') {
                            parent.window.location = '/juzi/Musictime/myMusic';
                        }
                    } else {
                        msgTisf(e.msg);
                    }
                });
            });

        });
    })(this, jQuery);
</script>
{include file="common/footer" /}
</body>
</html>