<!DOCTYPE html>
<html>
<head>
{include file="common/meta" /}
</head>
<base target="_parent" />
<body>
{include file="common/header" /}

<link href="/assets/css/juzi/music/write.css" rel="stylesheet">
<link href="/assets/libs/editormd/css/editormd.min.css" rel="stylesheet">
<script src="/assets/libs/editormd/editormd.min.js"></script>
<div >
    <div class="panel">
        <div class="well">
            [歌曲:<?=$musicInfo['songTitle']?>,<?=$musicInfo['singer']?>] <?=$topTitle;?>
        </div>
        <form class="form-horizontal" role="form" id="postXinliForm">
            <input type="hidden" class="form-control" name="row[musicId]" value="<?=$musicId?>" />
            <input type="hidden" class="form-control" name="row[id]" value="<?=$liId?>" />
             <div class="row rowWrap normalWrap">
                 <div class="form-group">
                     <div class="col-sm-12" id="show_editor_box">
                         <textarea class="form-control" name="row[content]" style="height: 300px;"><?=$liInfo['content']?></textarea>
                     </div>
                 </div>
                 <div class="form-group">
                     <label class="col-sm-2 control-label">隐私</label>
                     <div class="col-sm-10">
                         <label class="openLabel">
                             <input type="radio" class="openedFind" name="row[opened]" value="1" checked />公开
                         </label>
                         <label class="openLabel">
                             <input type="radio" class="openedFind" name="row[opened]" value="0"  />自己可见
                         </label>
                     </div>
                 </div>
             </div>
            <div class="row">
                <div class="col-md-12">
                    <button type="submit" class="btn btn-block btn-info btn-lg"><?=$submitBtnText?></button>
                </div>
            </div>
        </form>
    </div>
</div>
<script>
    (function (global__, $) {
        $(document).ready(function () {
            var modify = '<?=$modify?>';
            var opened = "<?=$liInfo['opened']?>";
            var submitXinliUrl = '/juzi/Musictime/write';
            var postForm = $('#postXinliForm');
            //open
            postForm.find(".openedFind").each(function () {
                var input_ = $(this);
                if(input_.val() != opened) {
                    input_.removeAttr('checked');
                } else {
                    input_.prop('checked', true);
                }
            });
            var opt_ = {
                width   : "100%",
                height  : 840,
                syncScrolling : "single",
                toolbarIcons : function() {
                    // Or return editormd.toolbarModes[name]; // full, simple, mini
                    // Using "||" set icons align right.
                    return ["bold", "quote", "h3", "del", "link", "list-ul", "list-ol",
                        "code",  "preformatted-text", "code-block", "table", "datetime","hr", "|", "file", "||", "watch", "preview"]
                },
                path    : "/assets/libs/editormd/lib/"
            };
            var editorId = 'show_editor_box';
            editormd(editorId, opt_);
            postForm.submit(function (e) {
                e.preventDefault();
                loadingSvg(true);
                var datas = {};
                $(this).serializeArray().map(function (x) {
                    datas[x.name] = x.value
                });
                rePost(submitXinliUrl, datas, function (e) {
                    noLoading();
                    if(e.code==1) {
                        msgTisf(e.msg);
                        if(modify == 'add') {
                            parent.window.location = '/juzi/Musictime/liList/id/<?=$musicId?>';
                        }
                    } else {
                        msgTisf(e.msg);
                    }
                });
            });

        });
    })(this, jQuery);
</script>
{include file="common/footer" /}
</body>
</html>