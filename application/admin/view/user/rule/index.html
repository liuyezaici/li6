<div class="panel panel-default panel-intro">
    {:build_heading()}

    <div class="panel-body">
        <div id="myTabContent" class="tab-content">
            <div class="tab-pane fade active in" id="one">
                <div class="widget-body no-padding">
                    <div id="toolbar" class="toolbar">
                        {:build_toolbar('refresh,add,edit,del')}
                        <div class="dropdown btn-group {:$auth->check('user/rule/multi')?'':'hide'}">
                            <a class="btn btn-primary btn-more dropdown-toggle btn-disabled disabled" data-toggle="dropdown"><i class="fa fa-cog"></i> {:__('More')}</a>
                            <ul class="dropdown-menu text-left" role="menu">
                                <li><a class="btn btn-link btn-multi btn-disabled disabled" href="javascript:;" data-params="status=normal"><i class="fa fa-eye"></i> {:__('Set to normal')}</a></li>
                                <li><a class="btn btn-link btn-multi btn-disabled disabled" href="javascript:;" data-params="status=hidden"><i class="fa fa-eye-slash"></i> {:__('Set to hidden')}</a></li>
                            </ul>
                        </div>
                    </div>
                    <table id="table" class="table table-striped table-bordered table-hover" 
                           data-operate-edit="{:$auth->check('user/rule/edit')}" 
                           data-operate-del="{:$auth->check('user/rule/del')}" 
                           width="100%">
                    </table>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        require(['jquery', 'bootstrap', 'backend', 'table', 'form'], function ($, undefined, Backend, Table, Form) {
        var Controller = {
            index: function () {
                // 初始化表格参数配置
                Table.api.init({
                    extend: {
                        index_url: 'user/rule/index',
                        add_url: 'user/rule/add',
                        edit_url: 'user/rule/edit',
                        del_url: 'user/rule/del',
                        multi_url: 'user/rule/multi',
                        table: 'user_rule',
                    }
                });

                var table = $("#table");

                // 初始化表格
                table.bootstrapTable({
                    url: $.fn.bootstrapTable.defaults.extend.index_url,
                    pk: 'id',
                    method: 'post',
                    sortName: 'weigh',
                    columns: [
                        [
                            {checkbox: true},
                            {field: 'id', title: __('Id')},
                            {field: 'pid', title: __('Pid'), visible: false},
                            {field: 'title', title: __('Title'), align: 'left', formatter:function (value, row, index) {
                                    return value.toString().replace(/(&|&amp;)nbsp;/g, '&nbsp;');
                                }
                            },
                            {field: 'name', title: __('Name'), align: 'left'},
                            {field: 'remark', title: __('Remark')},
                            {field: 'ismenu', title: __('Ismenu'), formatter: Table.api.formatter.toggle},
                            {field: 'createtime', title: __('Createtime'), formatter: Table.api.formatter.datetime, operate: 'RANGE', addclass: 'datetimerange', sortable: true, visible: false},
                            {field: 'updatetime', title: __('Updatetime'), formatter: Table.api.formatter.datetime, operate: 'RANGE', addclass: 'datetimerange', sortable: true, visible: false},
                            {field: 'weigh', title: __('Weigh')},
                            {field: 'status', title: __('Status'), formatter: Table.api.formatter.status},
                            {field: 'operate', title: __('Operate'), table: table, events: Table.api.events.operate, formatter: Table.api.formatter.operate}
                        ]
                    ],
                    pagination: false,
                    search: false,
                    commonSearch: false,
                });

                // 为表格绑定事件
                Table.api.bindevent(table);
            },
            add: function () {
                Controller.api.bindevent();
            },
            edit: function () {
                Controller.api.bindevent();
            },
            api: {
                bindevent: function () {
                    $(document).on('click', "input[name='row[ismenu]']", function () {
                        var name = $("input[name='row[name]']");
                        name.prop("placeholder", $(this).val() == 1 ? name.data("placeholder-menu") : name.data("placeholder-node"));
                    });
                    $("input[name='row[ismenu]']:checked").trigger("click");
                    Form.api.bindevent($("form[role=form]"));
                }
            }
        };
        Controller.index();
    });
    });
</script>