<div class="panel panel-default panel-intro">
    {:build_heading()}

    <div class="panel-body">
        <div id="myTabContent" class="tab-content">
            <div class="tab-pane fade active in" id="one">
                <div class="widget-body no-padding">
                    <div id="toolbar" class="toolbar">
                        {:build_toolbar('refresh,add,delete')}
                    </div>
                    <table id="table" class="table table-striped table-bordered table-hover"
                           data-operate-edit="{:$auth->check('auth/admin/edit')}"
                           data-operate-del="{:$auth->check('auth/admin/del')}"
                           width="100%">
                    </table>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        require(['jquery', 'bootstrap', 'backend', 'table', 'form'], function ($, undefined, Backend, Table, Form) {
            var Controller = {
                index: function () {
                    // 初始化表格参数配置
                    Table.api.init({
                        extend: {
                            index_url: 'auth/admin/index',
                            add_url: 'auth/admin/add',
                            edit_url: 'auth/admin/edit',
                            del_url: 'auth/admin/del',
                            multi_url: 'auth/admin/multi',
                        }
                    });
                    var table = $("#table");


                    // 初始化表格
                    table.bootstrapTable({
                        url: $.fn.bootstrapTable.defaults.extend.index_url,
                        method: 'post',
                        columns: [
                            [
                                {field: 'state', checkbox: true, },
                                {field: 'id', title: 'ID'},
                                {field: 'username', title: __('Username')},
                                {field: 'nickname', title: __('Nickname')},
                                {field: 'groups_text', title: __('Group'), operate:false, formatter: Table.api.formatter.label},
                                {field: 'email', title: __('Email')},
                                {field: 'status', title: __("Status"), searchList: {"normal":__('Normal'),"hidden":__('Hidden')}, formatter: Table.api.formatter.status},
                                {field: 'logintime', title: __('Login time'), formatter: Table.api.formatter.datetime, operate: 'RANGE', addclass: 'datetimerange', sortable: true},
                                {field: 'operate', title: __('Operate'), table: table, events: Table.api.events.operate, formatter: function (value, row, index) {
                                        return Table.api.formatter.operate.call(this, value, row, index);
                                    }}
                            ]
                        ]
                    });

                    // 为表格绑定事件
                    Table.api.bindevent(table);
                },
                add: function () {
                    Form.api.bindevent($("form[role=form]"));
                },
                edit: function () {
                    Form.api.bindevent($("form[role=form]"));
                }
            };
            return Controller.index();
        });

    });
</script>