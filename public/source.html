<script>


    require.config({
        baseUrl: '/assets/libs/lr/ele/',
        paths: {
            jquery: '/resource/pub/js/jq/jquery-1.8.3.min',
            lrBox: 'https://js.li6.cc/assets/libs/lr/box.ver/lrBox.1.1',
        }
    });
    require(['jquery', 'lrBox'], function ($, lrBox) {
        var box = $('#show_box');

        //当地时间
        var countryInput = box.find('.countryInput');
        var countryForm = box.find('.searchCountryForm');
        var showAllCountry = countryForm.find('.showAllCountry');
        var countryResultBox = countryForm.find('.countryResultBox');
        var stateResultBox = countryForm.find('.stateResultBox');
        var cityResultBox = countryForm.find('.cityResultBox');
        var countryInfoBox = countryForm.find('.countryInfoBox');
        var showCountryInfo = countryInfoBox.find('.showCountryInfo');
        var showStatesList = stateResultBox.find('.showStatesList');
        var stateInfoBox = countryForm.find('.stateInfoBox');
        var showCitiesList = countryForm.find('.showCitiesList');
        var cityInfoBox = countryForm.find('.cityInfoBox');

        //重置well的高度 取最大值作为标准 对齐高度
        function resetWellHeight() {
            var lis = showCountryInfo.find('.well');
            var maxHeight = 0;
            $.each(lis, function (n, v) {
                v = $(v);
                v.css('height', 'auto');
                var  hi_ = v.outerHeight();
                if(hi_ > maxHeight) {
                    maxHeight = hi_;
                }
            });
            $.each(lis, function (n, v) {
                v = $(v);
                v.css('height', maxHeight);
            });

        }
        countryInput.on('input propertychange', function () {
            var country = $(this).val();
            if(!country) {
                countryResultBox.hide();
                showAllCountry.html('');
                return;
            }
            $.post('/tool/world/findcountry',
                {
                    country: country
                },
                function (res) {
                    var countries = res.data;
                    if(!countries.length) {
                        showAllCountry.html('没有找到关键词：'+ country);
                        return;
                    }
                    var newCountryList = [];
                    var ctRadioTemp = $('<label> <input type="radio" name="choseCountry"> <span class="text"> <span class="name">China</span>  </span> </label>');
                    $.each(countries, function (n, v) {
                        var tmpItem = ctRadioTemp.clone();
                        tmpItem.find('input').val(v.id);
                        tmpItem.attr('title', v['native']).find('.name').html(v['name']);
                        tmpItem.click(function () {
                            getCountryInfo(v.id);
                            findStates(v.id);
                        });
                        newCountryList.push(tmpItem);
                    });
                    countryResultBox.show();
                    showAllCountry.html('').append(newCountryList);
                },
                'json');

        });

        //获取国家信息
        var getCountryInfo = function (ctId) {
            $.post('/tool/world/getcountryinfo',
                {
                    ctId: ctId
                },
                function (res) {
                    var countryInfo = res.data;
                    var ctInfoTemp = $('<div class="countryInfo">' +
                        '<div class="input-group"> <span class="input-group-addon">英文名：</span><span class="form-control"><span class="name">China</span></span> </div>\n' +
                        '<div class="input-group"> <span class="input-group-addon"> 当地名称：</span><span class="form-control"><span class="native">中国</span></span> </div>\n' +
                        '<div class="input-group"> <span class="input-group-addon">国际缩写：</span><span class="form-control"><span class="iso3">CN</span> <span class="iso2">CHN</span></span> </div>\n' +
                        '<div class="input-group"> <span class="input-group-addon">电话区号：</span><span class="form-control"><span class="phonecode">86</span></div>\n' +
                        '<div class="input-group"> <span class="input-group-addon">首都：</span><span class="form-control"><span class="capital">北京</span></span> </div>\n' +
                        '<div class="input-group"> <span class="input-group-addon">所属洲：</span><span class="form-control"><span class="region">Asia</span></span> </div>\n' +
                        '<div class="input-group"> <span class="input-group-addon">亚区：</span><span class="form-control"><span class="subregion">Eastern Asia</span></span> </div>\n' +
                        '<div class="input-group"> <span class="input-group-addon">经纬度：</span><span class="form-control"><span class="longitude"></span> ，<span class="latitude"></span></span> </div>\n' +
                        '<div class="input-group"> <span class="input-group-addon">货币缩写：</span><span class="form-control"><span class="currency"></span></span> </div>\n' +
                        '<div class="input-group"> <span class="input-group-addon">货币符号：</span><span class="form-control"><span class="currency_symbol"></span></span> </div>\n' +
                        '<div class="input-group"> <span class="input-group-addon">顶级域名：</span><span class="form-control"><span class="tld">.cn</span></div> ' +
                        '<h3> 包含时区：</h3><div class="timezones"></div>\n');
                    $.each(countryInfo, function (k, v) {
                        if(k == 'timezones') {
                            let jsonObj = JSON.parse(v);
                            let lis_ = [];
                            let parentRow = $('<div class="row"></div>');
                            $.each(jsonObj, function (i, datumv) {
                                var tmpItem = $('<div class="col-xs-12 col-sm-6 col-md-4 col-bg-3"><div class="well well-sm"></div></div>');
                                let li2_ = [];
                                $.each(datumv, function (k, v) {
                                    li2_.push($('<div>'+  k +' : '+ v +'</div>'));
                                });
                                tmpItem.find('.well').append(li2_);
                                lis_.push(tmpItem);
                            });
                            parentRow.append(lis_);
                            ctInfoTemp.find('.'+ k).html('').append(parentRow);
                        } else {
                            ctInfoTemp.find('.'+ k).html((v||'&nbsp;'));
                        }
                    });
                    countryInfoBox.show();
                    showCountryInfo.html('').append(ctInfoTemp);
                    //重置well的高度 取最大值作为标准 对齐高度
                    resetWellHeight();
                },
                'json');
        };

        //找州
        var findStates = function(ctId) {
            stateInfoBox.hide();// 隐藏州详细信息
            $.post('/tool/world/findstates',
                {
                    ctId: ctId
                },
                function (res) {
                    var states = res.data;
                    if(!states.length) {
                        stateResultBox.show();
                        showStatesList.html('该国家'+ ctId +'不包含州');
                        return;
                    }
                    var newStateList = [];
                    var ctRadioTemp = $('<label> <input type="radio" name="choseState"> <span class="text"> <span class="name">China</span>  </span> </label>');
                    $.each(states, function (n, v) {
                        var tmpItem = ctRadioTemp.clone();
                        tmpItem.find('input').val(v.id);
                        tmpItem.attr('title', "Name:"+ v['name'] +"ISO:"+ v['iso2'] +"\nlatitude:"+ v['latitude'] +"\nlongitude:"+ v['longitude'] +"\nfips_code:"+ v['fips_code']).find('.name').html(v['name']);
                        tmpItem.click(function () {
                            pushStateInfo(v);
                            findCities(v.id);
                        });
                        newStateList.push(tmpItem);
                    });
                    stateResultBox.show();
                    showStatesList.html('').append(newStateList);
                },
                'json');
        };

        //写入州信息
        function pushStateInfo(v) {
            stateInfoBox.show();
            stateInfoBox.find('.showStateInfo').html("<div class=\"well well-sm\">Name: "+ v['name']
                +"<br/> ISO: "+ v['iso2']
                +"<br/> longitude: "+ v['latitude']
                +"<br/> longitude: "+ v['longitude']
                +"<br/> fips_code: "+ v['fips_code'] +"</div>");
        }


        //找市
        var findCities = function(stateId) {
            $.post('/tool/world/findcitys',
                {
                    stateId: stateId
                },
                function (res) {
                    var states = res.data;
                    if(!states.length) {
                        stateResultBox.show();
                        showCitiesList.html('该州'+ stateId +'不包含市');
                        return;
                    }
                    var newCityList = [];
                    var ctRadioTemp = $('<label> <input type="radio" name="choseCity"> <span class="text"> <span class="name"></span>  </span> </label>');
                    $.each(states, function (n, v) {
                        var tmpItem = ctRadioTemp.clone();
                        tmpItem.find('input').val(v.id);
                        tmpItem.attr('title', "Name:"+ v['name'] +"\nlatitude:"+ v['latitude'] +"\nlongitude:"+ v['longitude']).find('.name').html(v['name']);
                        tmpItem.click(function () {
                            pushCityInfo(v);
                        });
                        newCityList.push(tmpItem);
                    });
                    cityResultBox.show();
                    showCitiesList.html('').append(newCityList);
                },
                'json');
        };

        //写入市信息
        function pushCityInfo(v) {
            cityInfoBox.show();
            cityInfoBox.find('.showCityInfo').html("<div class=\"well well-sm\">Name: "+ v['name']
                +"<br/> longitude: "+ v['latitude']
                +"<br/> longitude: "+ v['longitude']
                +"</div>");
        }


        //页面改变大小事件
        $(document).ready(function(){
            //重置well的高度 取最大值作为标准 对齐高度
            resetWellHeight();
        });
        window.onresize =  function() {
            //重置well的高度 取最大值作为标准 对齐高度
            resetWellHeight();
        };
    });
</script>
